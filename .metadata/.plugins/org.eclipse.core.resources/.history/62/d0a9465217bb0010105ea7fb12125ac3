package vista;

import dao.ClientesDAO;
import swing.ButtonEditor;
import vista.swing.ButtonRenderer;

import javax.swing.*;
import javax.swing.table.TableColumnModel;
import java.util.List;

import static javax.swing.JOptionPane.*;

public class ClientesPanel extends BaseCrudPanel {
    public ClientesPanel() {
        super(new String[]{"ID","Nombre","Email","Edad","Editar","Borrar"});
        configurarColumnas();
        cargar();
    }
    @Override protected boolean isAccionesColumn(int c){ return c>=4; }
    @Override protected Class<?> columnClass(int c){ return (c==0||c==3)? Integer.class : String.class; }

    @Override protected void configurarColumnas() {
        TableColumnModel cols = tabla.getColumnModel();
        cols.getColumn(0).setPreferredWidth(60);
        cols.getColumn(1).setPreferredWidth(260);
        cols.getColumn(2).setPreferredWidth(320);
        cols.getColumn(3).setPreferredWidth(60);
        cols.getColumn(4).setPreferredWidth(90);
        cols.getColumn(5).setPreferredWidth(90);

        cols.getColumn(4).setCellRenderer(new ButtonRenderer("Editar"));
        cols.getColumn(4).setCellEditor(new ButtonEditor("Editar", row -> editar(idFromViewRow(row))));
        cols.getColumn(5).setCellRenderer(new ButtonRenderer("Borrar"));
        cols.getColumn(5).setCellEditor(new ButtonEditor("Borrar", row -> borrar(idFromViewRow(row))));
    }

    @Override protected void cargar() {
        try {
            List<Object[]> filas = new ClientesDAO().listarTodos();
            modelo.setRowCount(0);
            for (Object[] f: filas) modelo.addRow(new Object[]{f[0],f[1],f[2],f[3],"Editar","Borrar"});
        } catch (Exception ex) {
            ex.printStackTrace();
            showMessageDialog(this, "Error al listar: "+ex.getMessage(), "Error", ERROR_MESSAGE);
        }
    }

    @Override protected void nuevo() {
        // aquí puedes abrir editor inline o un JDialog reutilizable
        showMessageDialog(this, "Nuevo cliente (conectar editor)", "Info", INFORMATION_MESSAGE);
        cargar();
    }

    private void editar(int id){
        if (id<0) return;
        showMessageDialog(this, "Editar cliente ID "+id+" (conectar editor)", "Editar", INFORMATION_MESSAGE);
        cargar();
    }
    private void borrar(int id){
        if (id<0) return;
        if (YES_OPTION != showConfirmDialog(this, "¿Borrar cliente ID "+id+"?", "Confirmar", YES_NO_OPTION)) return;
        try {
            int n = new ClientesDAO().borrar(id);
            if (n>0) cargar();
        } catch (Exception ex){
            ex.printStackTrace();
            showMessageDialog(this, "No se pudo borrar: "+ex.getMessage(), "Error", ERROR_MESSAGE);
        }
    }
}
